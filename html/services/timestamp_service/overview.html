

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="../../_static/release-notes.css?v=b943762f" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=fd4cc2db" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=4191f987"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Clusters" href="clustering.html" />
    <link rel="prev" title="Timestamp Service" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            OSS AtlasDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Services</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../key_value_services/index.html">Key Value Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lock_service/index.html">Lock Service</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Timestamp Service</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="clustering.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html">Service Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../timelock_service/index.html">External Timelock Service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Services</a></li>
          <li class="breadcrumb-item"><a href="index.html">Timestamp Service</a></li>
      <li class="breadcrumb-item active">Overview</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/services/timestamp_service/overview.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h1>
<p>The Timestamp Service exposes an API that allows for clients to request fresh timestamps, which are required by the
AtlasDB transaction protocol. These timestamps are <em>logical timestamps</em> (that is, they have no relationship to actual
wall-clock time), and are returned as signed 64-bit integers.</p>
<section id="guarantees">
<h2>Guarantees<a class="headerlink" href="#guarantees" title="Permalink to this heading"></a></h2>
<p>We guarantee that a request for a fresh timestamp will return a strictly greater timestamp than any other timestamp
already returned by an earlier request. In particular, this does <em>not</em> mean that the timestamps clients
see will necessarily be monotonically increasing. The following sequence of events is allowed:</p>
<ol class="arabic simple">
<li><p>Node A is the Leader</p></li>
<li><p>Node A receives request for timestamp</p></li>
<li><p>Node A enters bad GC cycle / JVM goes to sleep etc.</p></li>
<li><p>Node B becomes the Leader</p></li>
<li><p>Node B receives request for timestamp</p></li>
<li><p>Node B hands out timestamp X+1 and its client receives it</p></li>
<li><p>Node A becomes functional again</p></li>
<li><p>Node A hands out timestamp X and its client receives it</p></li>
</ol>
<p>However, we guarantee the following sequence of events will not happen:</p>
<ol class="arabic simple">
<li><p>Node A is the Leader</p></li>
<li><p>Node A receives request for timestamp</p></li>
<li><p>Node A hands out timestamp X+1 and its client receives it</p></li>
<li><p>Node B becomes the Leader</p></li>
<li><p>Node B receives request for timestamp</p></li>
<li><p>Node B hands out timestamp X and its client receives it</p></li>
</ol>
<p>Furthermore, there are also no guarantees that the timestamps issued will be consecutive.</p>
<p>We guarantee the above ordering across system restarts as well.</p>
</section>
<section id="contiguous-blocks">
<h2>Contiguous Blocks<a class="headerlink" href="#contiguous-blocks" title="Permalink to this heading"></a></h2>
<p>Users are allowed to make requests for contiguous blocks of timestamps using the <code class="docutils literal notranslate"><span class="pre">getFreshTimestamps</span></code> endpoint.
This may be useful if one knows it is the only client and/or wishes to have bespoke complex concurrency semantics.</p>
<p>The endpoint will return a contiguous block of timestamps; this is indicated by a lower and upper bound (inclusive
on both ends). We guarantee that the range returned will consist of at least 1 timestamp, and will have <em>at most</em>
as many timestamps as the number requested. However, we do not guarantee that the size of the timestamp range will be
equal to the number of timestamps requested for; the onus to check this is on the client.</p>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Permalink to this heading"></a></h2>
<p>To guarantee that timestamps still increase across system restarts, we need to persist some kind of a record of
what timestamps we’ve issued to stable storage. However, doing this on each timestamp request is unperformant, as
we would need a database operation, and in clustered mode we would also need to achieve distributed consensus.</p>
<p>Thus, instead of updating this record on every timestamp, the Timestamp Service will “reserve” a large number of
timestamps (currently 1,000,000) and update the bound to be the end of that range. When clients talk to the
Timestamp Service, it will issue timestamps from the range it knows it has, requesting more if necessary. We thus only
have one “persist” action every million timestamps. This can lead to there being gaps in timestamps when servers
are restarted and/or there is a leadership change in clustered mode, but that’s allowed by our guarantees.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Timestamp Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="clustering.html" class="btn btn-neutral float-right" title="Clusters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>