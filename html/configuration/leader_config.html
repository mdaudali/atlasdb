

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leader Configuration &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/release-notes.css?v=b943762f" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=fd4cc2db" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4191f987"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging Configuration" href="logging.html" />
    <link rel="prev" title="Enabling Cassandra Tracing" href="enabling_cassandra_tracing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OSS AtlasDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="key_value_service_configs/index.html">Key Value Service Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_timelock_service_configs/index.html">External Timelock Service Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cassandra_config.html">Cassandra Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="multinode_cassandra.html">Multinode Cassandra HA Guarantees</a></li>
<li class="toctree-l2"><a class="reference internal" href="enabling_cassandra_tracing.html">Enabling Cassandra Tracing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Leader Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamp_client.html">Timestamp Client Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="internal_schemas.html">Internal Schema Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Configuration</a></li>
      <li class="breadcrumb-item active">Leader Configuration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/configuration/leader_config.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="leader-configuration">
<span id="leader-config"></span><h1>Leader Configuration<a class="headerlink" href="#leader-configuration" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The leader block is where you specify configurations related to leadership election of your AtlasDB clients.
It’s good practice to always specify a leader configuration, even if there is a single AtlasDB client in your cluster.
If no leader configuration is specified, then AtlasDB clients will create an embedded timestamp and lock service.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you wish to run more than one AtlasDB client with Cassandra KVS, then you <strong>must</strong> provide a leader block.
Failure to do so can lead to data corruption.</p>
</div>
</section>
<section id="leader">
<h2>Leader<a class="headerlink" href="#leader" title="Permalink to this heading"></a></h2>
<p>Required parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>quorumSize</p></td>
<td><p>Number of AtlasDB clients in your cluster that form a majority.
This number must be greater than half of the total number of clients.</p></td>
</tr>
<tr class="row-odd"><td><p>leaders</p></td>
<td><p>A list of all hosts.
The protocol must be http/https depending on if ssl is configured.</p></td>
</tr>
<tr class="row-even"><td><p>localServer</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">protocol://hostname:port</span></code> eg: <code class="docutils literal notranslate"><span class="pre">https://myhost:3828</span></code> of the host on which this config exists.</p></td>
</tr>
</tbody>
</table>
<p>Optional parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sslConfiguration</p></td>
<td><p>The security settings to apply to client-side connections to the AtlasDB services at the endpoints, other than <code class="docutils literal notranslate"><span class="pre">localServer</span></code>, listed in the <code class="docutils literal notranslate"><span class="pre">leaders</span></code> array, specified according to the <a class="reference external" href="https://github.com/palantir/http-remoting/blob/develop/ssl-config/src/main/java/com/palantir/remoting2/config/ssl/SslConfiguration.java">palantir/http-remoting</a> library. (defaults to not using SSL)</p></td>
</tr>
<tr class="row-odd"><td><p>learnerLogDir</p></td>
<td><p>Path to the paxos learner logs (defaults to var/data/paxos/learner)</p></td>
</tr>
<tr class="row-even"><td><p>acceptorLogDir</p></td>
<td><p>Path to the paxos acceptor logs (defaults to var/data/paxos/acceptor)</p></td>
</tr>
<tr class="row-odd"><td><p>lockCreator</p></td>
<td><p>The host responsible for creation of the schema mutation lock table.
If specified, this must be same across all hosts.
This defaults to the first host in the sorted leaders list, so it should be consistent across nodes if not specifed.</p></td>
</tr>
<tr class="row-even"><td><p>pingRateMs</p></td>
<td><p>Defaults to 5000.</p></td>
</tr>
<tr class="row-odd"><td><p>randomWaitBeforeProposingLeadershipMs</p></td>
<td><p>Defaults to 1000.</p></td>
</tr>
<tr class="row-even"><td><p>leaderPingResponseWaitMs</p></td>
<td><p>Defaults to 5000.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="leader-configuration-examples">
<span id="leader-config-examples"></span><h2>Leader Configuration Examples<a class="headerlink" href="#leader-configuration-examples" title="Permalink to this heading"></a></h2>
<p>Some example leader block configurations are listed below.
The use of <cite>cluster</cite> and <cite>nodes</cite> are in reference to AtlasDB clients and are unrelated to your <code class="docutils literal notranslate"><span class="pre">keyValueService</span></code> config block.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#multiple-atlasdb-clients" id="id1">Multiple AtlasDB Clients</a></p></li>
<li><p><a class="reference internal" href="#single-atlasdb-client-or-offline-cli-with-leader-block" id="id2">Single AtlasDB Client or Offline CLI with Leader Block</a></p></li>
<li><p><a class="reference internal" href="#single-atlasdb-client-without-leader-block-deprecated" id="id3">Single AtlasDB Client without Leader Block (DEPRECATED)</a></p></li>
<li><p><a class="reference internal" href="#no-leader-online-cli-only" id="id4">No leader (Online CLI Only)</a></p></li>
</ul>
</nav>
<section id="multiple-atlasdb-clients">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Multiple AtlasDB Clients</a><a class="headerlink" href="#multiple-atlasdb-clients" title="Permalink to this heading"></a></h3>
<p>A leader configuration block is required if you are using multiple AtlasDB clients.
Failure to specify a leader configuration could lead to data corruption.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">atlasdb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keyValueService</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">    </span><span class="c1"># omitted for brevity</span>

<span class="w">  </span><span class="nt">leader</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># This should be at least half the number of nodes in your cluster</span>
<span class="w">    </span><span class="nt">quorumSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">learnerLogDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/data/paxosLogs</span>
<span class="w">    </span><span class="nt">acceptorLogDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/data/paxosLogs</span>
<span class="w">    </span><span class="c1"># This should be different for every node. If ssl is not enabled, then the host must be specified as http</span>
<span class="w">    </span><span class="nt">localServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span>
<span class="w">    </span><span class="c1"># This should be the same for every node. If ssl is not enabled, then the host must be specified as http</span>
<span class="w">    </span><span class="nt">lockCreator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span>
<span class="w">    </span><span class="c1"># This should be the same for every node</span>
<span class="w">    </span><span class="nt">leaders</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span><span class="w"> </span><span class="c1"># If ssl is not enabled, then the hosts must be specified as http</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host2:3828</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host3:3828</span>
<span class="w">    </span><span class="nt">sslConfiguration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">trustStorePath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/security/truststore.jks</span>
</pre></div>
</div>
</section>
<section id="single-atlasdb-client-or-offline-cli-with-leader-block">
<span id="leader-config-single-client-with-leader"></span><h3><a class="toc-backref" href="#id2" role="doc-backlink">Single AtlasDB Client or Offline CLI with Leader Block</a><a class="headerlink" href="#single-atlasdb-client-or-offline-cli-with-leader-block" title="Permalink to this heading"></a></h3>
<p>Similar to the above configuration, but with only a single leader specified in <code class="docutils literal notranslate"><span class="pre">leaders</span></code>.
To run an <a class="reference internal" href="../cluster_management/clis.html#offline-clis"><span class="std std-ref">offline CLI</span></a>, you also need to specify a leader block.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">atlasdb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keyValueService</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">    </span><span class="c1"># omitted for brevity</span>

<span class="w">  </span><span class="nt">leader</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># This should be at least half the number of nodes in your cluster</span>
<span class="w">    </span><span class="nt">quorumSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">learnerLogDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/data/paxosLogs</span>
<span class="w">    </span><span class="nt">acceptorLogDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/data/paxosLogs</span>
<span class="w">    </span><span class="c1"># This should be different for every node. If ssl is not enabled, then the host must be specified as http</span>
<span class="w">    </span><span class="nt">localServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span>
<span class="w">    </span><span class="c1"># This should be the same for every node. If ssl is not enabled, then the host must be specified as http</span>
<span class="w">    </span><span class="nt">lockCreator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span>
<span class="w">    </span><span class="c1"># This should be the same for every node</span>
<span class="w">    </span><span class="nt">leaders</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://host1:3828</span><span class="w"> </span><span class="c1"># If ssl is not enabled, then the hosts must be specified as http</span>
</pre></div>
</div>
</section>
<section id="single-atlasdb-client-without-leader-block-deprecated">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Single AtlasDB Client without Leader Block (DEPRECATED)</a><a class="headerlink" href="#single-atlasdb-client-without-leader-block-deprecated" title="Permalink to this heading"></a></h3>
<p>If you only have one AtlasDB client, then you may run with no leader block, although this option is deprecated, and will be removed in a future release.
An example configuration is below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">atlasdb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keyValueService</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">    </span><span class="c1"># omitted for brevity</span>

<span class="w">  </span><span class="c1"># no leader block</span>
</pre></div>
</div>
</section>
<section id="no-leader-online-cli-only">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">No leader (Online CLI Only)</a><a class="headerlink" href="#no-leader-online-cli-only" title="Permalink to this heading"></a></h3>
<p>When you are running a client that can’t be a leader, for instance an online CLI, it is necessary to specify a remote lock and timestamp service running on your AtlasDB clients.
If you are running multiple AtlasDB clients, ensure your CLI is pointing at the correct hosts and ports for the service you wish to interact with.
If you are running an <a class="reference internal" href="../cluster_management/clis.html#offline-clis"><span class="std std-ref">offline CLI</span></a> then you must specify a leader block as noted above in the <a class="reference internal" href="#leader-config-single-client-with-leader"><span class="std std-ref">Single AtlasDB Client with Leader Block</span></a> section.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">atlasdb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keyValueService</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">    </span><span class="c1"># omitted for brevity</span>

<span class="w">  </span><span class="c1"># no leader block</span>

<span class="w">  </span><span class="nt">lock</span><span class="p">:</span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host1:3828/api&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host2:3828/api&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host3:3828/api&quot;</span>
<span class="w">    </span><span class="nt">sslConfiguration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">trustStorePath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/security/truststore.jks</span>

<span class="w">  </span><span class="nt">timestamp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host1:3828/api&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host2:3828/api&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;http://host3:3828/api&quot;</span>
<span class="w">    </span><span class="nt">sslConfiguration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">trustStorePath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var/security/truststore.jks</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="enabling_cassandra_tracing.html" class="btn btn-neutral float-left" title="Enabling Cassandra Tracing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="logging.html" class="btn btn-neutral float-right" title="Logging Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>