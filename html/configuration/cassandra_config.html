

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cassandra Configuration &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/release-notes.css?v=b943762f" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=fd4cc2db" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4191f987"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multinode Cassandra HA Guarantees" href="multinode_cassandra.html" />
    <link rel="prev" title="Timelock Client Configuration" href="external_timelock_service_configs/timelock_client_config.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OSS AtlasDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="key_value_service_configs/index.html">Key Value Service Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_timelock_service_configs/index.html">External Timelock Service Configurations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Cassandra Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="multinode_cassandra.html">Multinode Cassandra HA Guarantees</a></li>
<li class="toctree-l2"><a class="reference internal" href="enabling_cassandra_tracing.html">Enabling Cassandra Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="leader_config.html">Leader Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamp_client.html">Timestamp Client Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="internal_schemas.html">Internal Schema Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Configuration</a></li>
      <li class="breadcrumb-item active">Cassandra Configuration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/configuration/cassandra_config.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cassandra-configuration">
<h1>Cassandra Configuration<a class="headerlink" href="#cassandra-configuration" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>Make sure to run Cassandra with ByteOrderPartitioner (yes, I know
everyone disagrees, read below) and batch commit. Without batch commit,
your durability and transactional guarantees are non-existent and you
may as well just light your data on fire. When you enable batch commit,
you must also bump up the <code class="docutils literal notranslate"><span class="pre">concurrent_writes</span></code> param. Cassandra holds
every single row being written on its own thread until the batch sync.
This means you effectively need 1K threads to get any write throughput.</p>
<p>Again, you should edit <code class="docutils literal notranslate"><span class="pre">conf/cassandra.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">partitioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ByteOrderedPartitioner</span>
<span class="nt">commitlog_sync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch</span>
<span class="nt">commitlog_sync_batch_window_in_ms</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.1</span><span class="w">  </span><span class="c1"># .1 is only appropriate for SSDs.  Use 5 for HDDs.</span>
<span class="c1"># If you use HDDs, make sure the commit log has its own disk because it will thrash it.</span>
<span class="nt">concurrent_writes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
</pre></div>
</div>
</section>
<section id="in-defense-of-byteorderedpartitioner">
<h2>In Defense of ByteOrderedPartitioner<a class="headerlink" href="#in-defense-of-byteorderedpartitioner" title="Permalink to this heading"></a></h2>
<p>The Cassandra community has historically shunned the
ByteOrderedPartitioner and with good reasons. However I think that all
the valid reasons were fixed in 1.2 once vnodes were implemented. The
documentation and blogs have not evolved to reflect that
ByteOrderedParitioner is now the right default choice.</p>
<p>Yes, I know this is a very unpopular opinion. Here are some good quotes
that show what I’m up against (emphasis is mine).</p>
<blockquote>
<div><p><a class="reference external" href="http://10kloc.wordpress.com/2012/12/27/cassandra-chapter-4-data-partitioning/">we [..] looked at […] *RandomPartitioner* and
*ByteOrderedPartitioner [..]*. We reached the conclusion **Random
Partitioner should always be preferred** over any type of Ordered
Partitioning</a></p>
<p><a class="reference external" href="http://www.geroba.com/cassandra/apache-cassandra-byteorderedpartitioner/">So to sum this up: The Internet is right, **don’t use the
ByteOrderedPartitioner**</a></p>
</div></blockquote>
<p>Looking more closely, the downsides boil down to 2 points. The first is
that the ring will be hard to maintain because your data won’t be
randomly distributed. The second is that there will be hotspots due to
your data not being randomly distributed. The worry is that if you just
insert sequential row names you will basically get single node perf for
reads and writes.</p>
<p>I think both points are good starting advice due to hotspots. However
there are other systems out there like HBase that already force you to
think about this when you design a schema. I think choosing
RandomPartitioner limits your options because range scans are no longer
possible. If you really want your keys distributed randomly, you can do
so by prepending a hash to each key.</p>
<p>The main issue is that this setting is global in Cassandra. If you want
range scans for a single table, then you must use ByteOrderedParitioner.</p>
<p>I think with good schema design and thinking about your access patterns
then ByteOrderedPartitioner is a good default choice. If you have a
specific table where you need it to be randomly distributed, then you
can add a 2 byte hash to the front of each key.</p>
<p>In atlas this can be done by using
<code class="docutils literal notranslate"><span class="pre">ValueType.FIXED_LONG_LITTLE_ENDIAN</span></code>. This value type reverses the
bytes of a long so that the least significant byte is the first one.
Assuming your keys are evenly distributed in the least significant
bytes, this will get you good distribution even with the
ByteOrderedPartitioner.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="external_timelock_service_configs/timelock_client_config.html" class="btn btn-neutral float-left" title="Timelock Client Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multinode_cassandra.html" class="btn btn-neutral float-right" title="Multinode Cassandra HA Guarantees" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>