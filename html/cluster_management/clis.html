

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Command Line Utilities &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="../_static/release-notes.css?v=b943762f" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=fd4cc2db" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4191f987"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Console" href="console.html" />
    <link rel="prev" title="Cluster Management" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OSS AtlasDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Cluster Management</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Command Line Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="kvs-migration.html">KVS Migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="sweep.html">AtlasDB Sweep</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Cluster Management</a></li>
      <li class="breadcrumb-item active">Command Line Utilities</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/cluster_management/clis.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="command-line-utilities">
<span id="clis"></span><h1>Command Line Utilities<a class="headerlink" href="#command-line-utilities" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>For certain pieces of common functionality AtlasDB offers command line
scripts. These scripts can be used to help automate common maintance
tasks as well as help resolve problems encountered during operation.</p>
</section>
<section id="download-the-cli">
<h2>Download The CLI<a class="headerlink" href="#download-the-cli" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are working with Oracle KVS (whether directly, or as part of a migration) and are using a version of
AtlasDB before than 0.240.10, the standard AtlasDB CLI distribution will not work as it does not contain the
requisite Oracle drivers. Please contact the AtlasDB team for assistance.</p>
</div>
<p>The CLI now comes prebuilt as an SLS distribution to be used with any AtlasDB-backed product.
You can find the versions <a class="reference external" href="https://search.maven.org/artifact/com.palantir.atlasdb/atlasdb-cli-distribution">here</a> for download.
Click on the relevant CLI version that matches your target AtlasDB version, then select <cite>sls.tgz</cite> under the Downloads dropdown.
You can use the CLI by unpacking the tar ball and running the executable in <code class="docutils literal notranslate"><span class="pre">service/bin/atlasdb-cli</span></code>.</p>
</section>
<section id="general-cli-options">
<h2>General CLI Options<a class="headerlink" href="#general-cli-options" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 8.3%" />
<col style="width: 66.7%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--config</span></code></p></td>
<td><p>The path to the install config yml file of the service. Usually <code class="docutils literal notranslate"><span class="pre">var/conf/install.yml</span></code>.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--runtime-config</span></code></p></td>
<td><p>The path to the runtime config yml file of the service. Usually <code class="docutils literal notranslate"><span class="pre">var/conf/runtime.yml</span></code>. You should always
specify one if you have a runtime config file.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--inline-config</span></code></p></td>
<td><p>Use it if you want to provide the AtlasDB config as a string/json.
The config string should immediately follow the option.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--config-root</span></code></p></td>
<td><p>The AtlasDB config root for your install config. The CLI will by default look for <code class="docutils literal notranslate"><span class="pre">/atlasdb</span></code>/<code class="docutils literal notranslate"><span class="pre">/atlas</span></code> blocks in the config, but services can name these blocks arbitrarily.
This can usually be found by cracking open the install config file and searching for parameters defined in
<a class="reference external" href="https://github.com/palantir/atlasdb/blob/develop/atlasdb-config/src/main/java/com/palantir/atlasdb/config/AtlasDbConfig.java">Atlas Install config</a>.
The parent of these parameters will be the install config root.
Note that you have to provide the root with a ‘/’ as the first character.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--runtime-config-root</span></code></p></td>
<td><p>The AtlasDB config root for your runtime config. The CLI will by default look for <code class="docutils literal notranslate"><span class="pre">/atlasdb</span></code>/<code class="docutils literal notranslate"><span class="pre">/atlas</span></code> blocks in the config, but services can name these blocks arbitrarily.
This can usually be found by cracking open the runtime config file and searching for parameters defined in
<a class="reference external" href="https://github.com/palantir/atlasdb/blob/develop/atlasdb-config/src/main/java/com/palantir/atlasdb/config/AtlasDbRuntimeConfig.java">Atlas Runtime config</a>.
The parent of these parameters will be the runtime config root. If you do not have any AtlasDB runtime config,
you should get rid of the <code class="docutils literal notranslate"><span class="pre">runtime-config</span></code> option to the CLI and Atlas will assume the default config.
Note that you have to provide the root with a ‘/’ as the first character.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--offline</span></code></p></td>
<td><p>Some CLIs can only be run in the offline mode. This means that you have to shut down all nodes of the service
and then pass in this flag to the CLI.</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
<section id="compiling-the-cli">
<h2>Compiling The CLI<a class="headerlink" href="#compiling-the-cli" title="Permalink to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./gradlew<span class="w"> </span>atlasdb-cli-distribution:distTar
</pre></div>
</div>
<p>This will create a tar file in <code class="docutils literal notranslate"><span class="pre">atlasdb-cli-distribution/build/distributions</span></code>, which you can untar on the machine where your AtlasDB client is installed.</p>
</section>
<section id="built-in-commands">
<h2>Built-In Commands<a class="headerlink" href="#built-in-commands" title="Permalink to this heading"></a></h2>
<p>The following useful commands come with the vanilla atlasdb-cli.</p>
<section id="sweep">
<h3>sweep<a class="headerlink" href="#sweep" title="Permalink to this heading"></a></h3>
<p>Sweep old table rows.
This can be useful for improving performance if having too many dead cells is impacting read times.
The command allows you to specify a namespace or a specific set of tables.
For more information, check out <a class="reference internal" href="sweep/standard/sweep-cli.html#atlasdb-sweep-cli"><span class="std std-ref">the sweep CLI documentation</span></a>, or run <code class="docutils literal notranslate"><span class="pre">./bin/atlasdb</span> <span class="pre">help</span> <span class="pre">sweep</span></code>.</p>
</section>
<section id="timestamp">
<h3>timestamp<a class="headerlink" href="#timestamp" title="Permalink to this heading"></a></h3>
<p>Read or recalculate the immutable timestamp. Run <code class="docutils literal notranslate"><span class="pre">./bin/atlasdb</span> <span class="pre">help</span> <span class="pre">timestamp</span></code> for more information.</p>
</section>
<section id="migrate">
<span id="clis-migrate"></span><h3>migrate<a class="headerlink" href="#migrate" title="Permalink to this heading"></a></h3>
<p>Migrate data from one KVS to another. See <a class="reference internal" href="kvs-migration.html#kvs-migration"><span class="std std-ref">KVS migration</span></a> for details.</p>
</section>
<section id="read-punch-table">
<h3>read-punch-table<a class="headerlink" href="#read-punch-table" title="Permalink to this heading"></a></h3>
<p>Given an epoch time, in millis, the CLI reads the timestamp added to the punch table right before it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/atlasdb-cli<span class="w"> </span>--config<span class="w"> </span>config.yml<span class="w"> </span>read-punch-table<span class="w"> </span>--epoch
</pre></div>
</div>
</section>
</section>
<section id="offline-clis">
<span id="id1"></span><h2>Offline CLIs<a class="headerlink" href="#offline-clis" title="Permalink to this heading"></a></h2>
<p>Due to their potentially destructive nature if run concurrently with active AtlasDB services, there are a number of CLIs which can only be run when AtlasDB is offline. These are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clean-cass-locks-state</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">migrate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span> <span class="pre">clean-transactions</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span> <span class="pre">fast-forward</span></code></p></li>
</ul>
</div></blockquote>
<p>To run these CLIs, first ensure that all of your AtlasDB clients are shut down, and then run the CLI with the <code class="docutils literal notranslate"><span class="pre">--offline</span></code> flag.</p>
<p>For example, to run the <code class="docutils literal notranslate"><span class="pre">fast-forward</span></code> command with default settings, run <code class="docutils literal notranslate"><span class="pre">./bin/atlasdb</span> <span class="pre">--offline</span> <span class="pre">-c</span> <span class="pre">&lt;path/to/atlasConfig.yaml&gt;</span> <span class="pre">timestamp</span> <span class="pre">-t</span> <span class="pre">&lt;targetTimestamp&gt;</span> <span class="pre">fast-forward</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--offline</span></code> flag will make the CLI ignore the leader, timestamp, and lock configuration blocks.
If using <a class="reference internal" href="../services/timelock_service/index.html#external-timelock-service"><span class="std std-ref">external Timelock Services</span></a>, the Timelock Servers must be up even when running offline CLIs.
Otherwise, offline CLIs will start an embedded timestamp and lock server.
Once the CLI has completed, you can resume your AtlasDB clients.</p>
<section id="running-commands-without-any-servers-being-up">
<h3>Running commands without any servers being up<a class="headerlink" href="#running-commands-without-any-servers-being-up" title="Permalink to this heading"></a></h3>
<p>If you want a command to run without any servers being up, you can either use the <code class="docutils literal notranslate"><span class="pre">--offline</span></code> flag, or pass in a configuration file without leader, lock, or timestamp blocks.
Either option will start an embedded timestamp and lock server.
Note that if you are using external Timelock Services, as stated above we require the Timelock Services to be up when running offline CLIs.
We do not support running CLIs with Timelock down, as we will not have enough information from the key-value services to determine timestamps.</p>
</section>
</section>
<section id="writing-your-own">
<h2>Writing Your Own<a class="headerlink" href="#writing-your-own" title="Permalink to this heading"></a></h2>
<p>You can write a new CLI by extending <code class="docutils literal notranslate"><span class="pre">SingleBackendCommand.java</span></code> which
offers default AtlasDB configuration and connection out of the box.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Cluster Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="console.html" class="btn btn-neutral float-right" title="Console" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>